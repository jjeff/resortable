<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resortable - Complete Feature Demo</title>
  <style>
    /* CSS Variables for Theme */
    :root {
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --secondary: #64748b;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --border: #e2e8f0;
      --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --radius: 0.5rem;
      --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
    }

    /* Header */
    .header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      padding: 1.5rem 0;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: var(--shadow);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 2rem;
      height: 2rem;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.125rem;
    }

    .logo h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .version {
      background: var(--primary);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.75rem;
      font-weight: 600;
    }

    /* Main Content */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Feature Grid */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }

    /* Demo Card */
    .demo-card {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .demo-header {
      background: var(--bg-tertiary);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .demo-header h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .demo-header p {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .demo-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      padding: 1.5rem;
    }

    .demo-visual {
      min-height: 200px;
    }

    .demo-code {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Code Editor */
    .code-editor {
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .code-header {
      background: var(--bg-tertiary);
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .code-content {
      background: #1e293b;
      color: #e2e8f0;
      font-family: var(--font-mono);
      font-size: 0.875rem;
      line-height: 1.4;
    }

    .code-textarea {
      width: 100%;
      height: 150px;
      padding: 1rem;
      background: transparent;
      border: none;
      color: inherit;
      font-family: inherit;
      font-size: inherit;
      line-height: inherit;
      resize: vertical;
    }

    .code-textarea:focus {
      outline: none;
    }

    .code-output {
      height: 100px;
      padding: 1rem;
      background: #0f172a;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 0.75rem;
    }

    /* Sortable Lists */
    .sortable-list {
      min-height: 150px;
      padding: 0.5rem;
      background: var(--bg-secondary);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      list-style: none;
    }

    .sortable-item {
      background: white;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      cursor: grab;
      user-select: none;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sortable-item:active {
      cursor: grabbing;
    }

    .sortable-item:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow);
    }

    .sortable-item:last-child {
      margin-bottom: 0;
    }

    /* Sortable States */
    .sortable-ghost {
      opacity: 0.4;
      background: var(--bg-tertiary) !important;
      border-style: dashed;
    }

    .sortable-chosen {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
      border-color: var(--primary);
    }

    .sortable-drag {
      opacity: 0;
    }

    .sortable-selected {
      background: rgba(59, 130, 246, 0.1) !important;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }

    .sortable-focused {
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3);
      border-color: var(--warning);
    }

    /* Drag Handle */
    .drag-handle {
      color: var(--text-secondary);
      cursor: grab;
      padding: 0.25rem;
      border-radius: 0.25rem;
      transition: color 0.15s ease;
    }

    .drag-handle:hover {
      color: var(--primary);
      background: var(--bg-secondary);
    }

    .drag-handle:active {
      cursor: grabbing;
    }

    /* Item Content */
    .item-content {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .item-icon {
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
    }

    .item-text {
      font-weight: 500;
    }

    .item-meta {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* Group Colors */
    .group-shared .sortable-list {
      border-color: var(--success);
      background: rgba(16, 185, 129, 0.05);
    }

    .group-shared .sortable-item {
      border-left: 3px solid var(--success);
    }

    .group-clone .sortable-list {
      border-color: var(--warning);
      background: rgba(245, 158, 11, 0.05);
    }

    .group-clone .sortable-item {
      border-left: 3px solid var(--warning);
    }

    /* Grid Layout */
    .grid-sortable {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      padding: 0.5rem;
      background: var(--bg-secondary);
      border: 2px dashed var(--border);
      border-radius: var(--radius);
      min-height: 150px;
    }

    .grid-item {
      aspect-ratio: 1;
      background: white;
      border: 1px solid var(--border);
      border-radius: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: grab;
      transition: all 0.15s ease;
    }

    .grid-item:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow);
    }

    /* Filter Demo */
    .filter-demo .sortable-item {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .filter-demo input,
    .filter-demo button {
      padding: 0.375rem 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.25rem;
      font-size: 0.875rem;
    }

    .filter-demo button {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
      cursor: pointer;
    }

    .filter-demo button:hover {
      background: var(--primary-light);
    }

    /* Status Bar */
    .status-bar {
      background: var(--bg-tertiary);
      border-top: 1px solid var(--border);
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--success);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .demo-content {
        grid-template-columns: 1fr;
      }

      .features-grid {
        grid-template-columns: 1fr;
      }

      .container {
        padding: 1rem;
      }
    }

    /* Code Syntax Highlighting */
    .token.property { color: #7dd3fc; }
    .token.string { color: #86efac; }
    .token.number { color: #fbbf24; }
    .token.boolean { color: #f472b6; }
    .token.function { color: #a78bfa; }
    .token.keyword { color: #60a5fa; }
    .token.punctuation { color: #cbd5e1; }

    /* Plugin-specific Styles */
    .sortable-multi-drag {
      opacity: 0.8;
      transform: rotate(3deg);
    }

    .sortable-swap-highlight {
      background: rgba(245, 158, 11, 0.2) !important;
      border-color: var(--warning) !important;
      box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.4);
      transform: scale(1.05);
    }

    /* Nested Dragging Styles */
    .nested-container {
      background: var(--bg-primary);
      border: 2px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: 1rem;
      min-height: 120px;
      position: relative;
    }

    .nested-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: var(--bg-tertiary);
      border-bottom: 1px solid var(--border);
      border-radius: var(--radius) var(--radius) 0 0;
    }

    .nested-handle {
      color: var(--text-secondary);
      cursor: grab;
      padding: 0.25rem;
      font-size: 1rem;
      user-select: none;
    }

    .nested-handle:hover {
      color: var(--primary);
    }

    .nested-handle:active {
      cursor: grabbing;
    }

    .nested-title {
      font-weight: 600;
      color: var(--text-primary);
    }

    .nested-count {
      font-size: 0.75rem;
      color: var(--text-secondary);
      background: var(--bg-secondary);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      margin-left: auto;
    }

    .horizontal-items {
      display: flex;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      min-height: 80px;
      align-items: flex-start;
      flex-wrap: wrap;
      background: var(--bg-secondary);
      border-radius: 0 0 var(--radius) var(--radius);
    }

    .horizontal-item {
      width: 60px;
      height: 60px;
      background: white;
      border: 2px solid var(--border);
      border-radius: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.875rem;
      cursor: grab;
      transition: all 0.15s ease;
      position: relative;
      flex-shrink: 0;
    }

    .horizontal-item:hover {
      border-color: var(--primary-light);
      box-shadow: var(--shadow);
      transform: translateY(-2px);
    }

    .horizontal-item:active {
      cursor: grabbing;
    }

    .horizontal-item.color-1 { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .horizontal-item.color-2 { background: linear-gradient(135deg, #10b981, #047857); color: white; }
    .horizontal-item.color-3 { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
    .horizontal-item.color-4 { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
    .horizontal-item.color-5 { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
    .horizontal-item.color-6 { background: linear-gradient(135deg, #06b6d4, #0891b2); color: white; }
    .horizontal-item.color-7 { background: linear-gradient(135deg, #84cc16, #65a30d); color: white; }
    .horizontal-item.color-8 { background: linear-gradient(135deg, #f97316, #ea580c); color: white; }

    /* Nested container states */
    .nested-container.sortable-chosen {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
    }

    .nested-container.sortable-ghost {
      opacity: 0.4;
      background: var(--bg-tertiary);
    }

    /* Empty state for horizontal containers */
    .horizontal-items:empty {
      position: relative;
    }

    .horizontal-items:empty::after {
      content: 'Drop items here';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-style: italic;
      pointer-events: none; /* Critical: allows drops to pass through */
      white-space: nowrap;
    }

    .horizontal-items:empty::before {
      content: '';
      display: block;
      height: 60px;
      width: 100%;
      border: 2px dashed var(--border);
      border-radius: 0.375rem;
      background: var(--bg-primary);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon">R</div>
        <h1>Resortable</h1>
        <span class="version">v2.0.0</span>
      </div>
      <div>Complete Feature Demo</div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Introduction -->
    <section>
      <h2>Interactive Feature Showcase</h2>
      <p>Explore all Resortable features with live examples, editable configuration, and real-time JSON output. Click and edit any configuration to see immediate results.</p>
    </section>

    <!-- Features Grid -->
    <div class="features-grid">

      <!-- Basic Sorting -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Basic Sorting</h3>
          <p>Core drag-and-drop functionality with smooth FLIP animations</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <ul class="sortable-list" id="basic-list">
              <li class="sortable-item" data-id="basic-1">
                <div class="item-content">
                  <div class="item-icon" style="background: #3b82f6;">1</div>
                  <div>
                    <div class="item-text">First Item</div>
                    <div class="item-meta">Drag me around</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="basic-2">
                <div class="item-content">
                  <div class="item-icon" style="background: #10b981;">2</div>
                  <div>
                    <div class="item-text">Second Item</div>
                    <div class="item-meta">Smooth animations</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="basic-3">
                <div class="item-content">
                  <div class="item-icon" style="background: #f59e0b;">3</div>
                  <div>
                    <div class="item-text">Third Item</div>
                    <div class="item-meta">FLIP technique</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="basic-4">
                <div class="item-content">
                  <div class="item-icon" style="background: #ef4444;">4</div>
                  <div>
                    <div class="item-text">Fourth Item</div>
                    <div class="item-meta">60fps performance</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="basic-config">{
  "animation": 150,
  "easing": "cubic-bezier(0.4, 0.0, 0.2, 1)",
  "ghostClass": "sortable-ghost",
  "chosenClass": "sortable-chosen",
  "dragClass": "sortable-drag"
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="basic-output">Ready for drag operations...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Multi-Selection -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Multi-Selection & Accessibility</h3>
          <p>Keyboard navigation, multi-select with Ctrl+Click, ARIA support</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <ul class="sortable-list" id="multi-list" tabindex="0" role="listbox" aria-label="Multi-selectable list">
              <li class="sortable-item" data-id="multi-1" role="option" aria-selected="false">
                <div class="item-content">
                  <div class="item-icon" style="background: #8b5cf6;">📋</div>
                  <div>
                    <div class="item-text">Task Management</div>
                    <div class="item-meta">Ctrl+Click to select</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="multi-2" role="option" aria-selected="false">
                <div class="item-content">
                  <div class="item-icon" style="background: #06b6d4;">📊</div>
                  <div>
                    <div class="item-text">Data Analysis</div>
                    <div class="item-meta">Use arrow keys</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="multi-3" role="option" aria-selected="false">
                <div class="item-content">
                  <div class="item-icon" style="background: #84cc16;">🎨</div>
                  <div>
                    <div class="item-text">Design System</div>
                    <div class="item-meta">Space to select</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="multi-4" role="option" aria-selected="false">
                <div class="item-content">
                  <div class="item-icon" style="background: #f97316;">⚡</div>
                  <div>
                    <div class="item-text">Performance</div>
                    <div class="item-meta">Enter to grab</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="multi-config">{
  "multiDrag": true,
  "selectedClass": "sortable-selected",
  "focusClass": "sortable-focused",
  "enableAccessibility": true,
  "animation": 200
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="multi-output">Use Ctrl+Click for multi-selection...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Handle & Filter -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Handles & Filters</h3>
          <p>Restrict dragging to handles, filter out interactive elements</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual filter-demo">
            <ul class="sortable-list" id="handle-list">
              <li class="sortable-item" data-id="handle-1">
                <div class="drag-handle">⋮⋮</div>
                <div class="item-content">
                  <div class="item-text">Form Field</div>
                  <input type="text" value="Editable input" style="width: 120px;">
                </div>
              </li>
              <li class="sortable-item" data-id="handle-2">
                <div class="drag-handle">⋮⋮</div>
                <div class="item-content">
                  <div class="item-text">Action Item</div>
                  <button>Click Me</button>
                </div>
              </li>
              <li class="sortable-item" data-id="handle-3">
                <div class="drag-handle">⋮⋮</div>
                <div class="item-content">
                  <div class="item-text">Text Area</div>
                  <textarea style="width: 100px; height: 60px; resize: none;">Content here</textarea>
                </div>
              </li>
            </ul>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="handle-config">{
  "handle": ".drag-handle",
  "filter": "input, button, textarea",
  "preventOnFilter": true,
  "animation": 150
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="handle-output">Drag from handle only...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Shared Groups -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Shared Groups</h3>
          <p>Drag items between different lists with group configuration</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div class="group-shared">
                <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Todo</h4>
                <ul class="sortable-list" id="group-todo">
                  <li class="sortable-item" data-id="todo-1">
                    <div class="item-content">
                      <div class="item-icon" style="background: #64748b;">📝</div>
                      <div class="item-text">Write documentation</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="todo-2">
                    <div class="item-content">
                      <div class="item-icon" style="background: #64748b;">🔍</div>
                      <div class="item-text">Code review</div>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="group-shared">
                <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Done</h4>
                <ul class="sortable-list" id="group-done">
                  <li class="sortable-item" data-id="done-1">
                    <div class="item-content">
                      <div class="item-icon" style="background: #10b981;">✅</div>
                      <div class="item-text">Feature complete</div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="group-config">{
  "group": "shared-tasks",
  "animation": 150,
  "ghostClass": "sortable-ghost"
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="group-output">Drag between lists...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Clone Mode -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Clone Mode</h3>
          <p>Clone items when dragging between lists (group.pull: 'clone')</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div class="group-clone">
                <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Components (Clone Source)</h4>
                <ul class="sortable-list" id="clone-source">
                  <li class="sortable-item" data-id="comp-1">
                    <div class="item-content">
                      <div class="item-icon" style="background: #f59e0b;">🔧</div>
                      <div class="item-text">Button Component</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="comp-2">
                    <div class="item-content">
                      <div class="item-icon" style="background: #f59e0b;">📝</div>
                      <div class="item-text">Input Field</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="comp-3">
                    <div class="item-content">
                      <div class="item-icon" style="background: #f59e0b;">📊</div>
                      <div class="item-text">Chart Widget</div>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="group-shared">
                <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Page Builder</h4>
                <ul class="sortable-list" id="clone-target">
                  <li class="sortable-item" data-id="target-1">
                    <div class="item-content">
                      <div class="item-icon" style="background: #10b981;">📄</div>
                      <div class="item-text">Header Section</div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="clone-config">{
  "group": {
    "name": "components",
    "pull": "clone",
    "put": false
  },
  "animation": 150
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="clone-output">Drag to clone components...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Grid Layout -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Grid Layout</h3>
          <p>2D grid sorting with automatic direction detection</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <div class="grid-sortable" id="grid-layout">
              <div class="grid-item sortable-item" data-id="grid-1" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">1</div>
              <div class="grid-item sortable-item" data-id="grid-2" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">2</div>
              <div class="grid-item sortable-item" data-id="grid-3" style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white;">3</div>
              <div class="grid-item sortable-item" data-id="grid-4" style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white;">4</div>
              <div class="grid-item sortable-item" data-id="grid-5" style="background: linear-gradient(135deg, #fa709a, #fee140); color: white;">5</div>
              <div class="grid-item sortable-item" data-id="grid-6" style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: white;">6</div>
            </div>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="grid-config">{
  "animation": 200,
  "ghostClass": "sortable-ghost",
  "direction": "horizontal",
  "swapThreshold": 0.5
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="grid-output">Grid sorting ready...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Delay & Thresholds -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Delay & Thresholds</h3>
          <p>Touch-friendly delays and movement thresholds</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <ul class="sortable-list" id="delay-list">
              <li class="sortable-item" data-id="delay-1">
                <div class="item-content">
                  <div class="item-icon" style="background: #8b5cf6;">⏱️</div>
                  <div>
                    <div class="item-text">Delayed Start</div>
                    <div class="item-meta">300ms delay</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="delay-2">
                <div class="item-content">
                  <div class="item-icon" style="background: #06b6d4;">📱</div>
                  <div>
                    <div class="item-text">Touch Optimized</div>
                    <div class="item-meta">Movement threshold</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="delay-3">
                <div class="item-content">
                  <div class="item-icon" style="background: #84cc16;">🎯</div>
                  <div>
                    <div class="item-text">Precise Control</div>
                    <div class="item-meta">Prevents accidental drags</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="delay-config">{
  "delay": 300,
  "delayOnTouchOnly": true,
  "touchStartThreshold": 10,
  "animation": 150
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="delay-output">Try dragging with delay...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MultiDrag Plugin -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>MultiDrag Plugin</h3>
          <p>Advanced multi-selection with Ctrl+Click, Shift+Click for ranges</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <ul class="sortable-list" id="multidrag-list">
              <li class="sortable-item" data-id="md-1">
                <div class="item-content">
                  <div class="item-icon" style="background: #6366f1;">📄</div>
                  <div>
                    <div class="item-text">Document.pdf</div>
                    <div class="item-meta">2.3 MB</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="md-2">
                <div class="item-content">
                  <div class="item-icon" style="background: #10b981;">📊</div>
                  <div>
                    <div class="item-text">Spreadsheet.xlsx</div>
                    <div class="item-meta">1.8 MB</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="md-3">
                <div class="item-content">
                  <div class="item-icon" style="background: #f59e0b;">🖼️</div>
                  <div>
                    <div class="item-text">Image.jpg</div>
                    <div class="item-meta">4.2 MB</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="md-4">
                <div class="item-content">
                  <div class="item-icon" style="background: #ef4444;">🎥</div>
                  <div>
                    <div class="item-text">Video.mp4</div>
                    <div class="item-meta">15.7 MB</div>
                  </div>
                </div>
              </li>
              <li class="sortable-item" data-id="md-5">
                <div class="item-content">
                  <div class="item-icon" style="background: #8b5cf6;">🎵</div>
                  <div>
                    <div class="item-text">Audio.mp3</div>
                    <div class="item-meta">3.1 MB</div>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="multidrag-config">{
  "multiDrag": true,
  "selectedClass": "sortable-selected",
  "maxSelections": 3,
  "multiSelectKey": "ctrlKey",
  "allowRangeSelection": true,
  "animation": 150
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="multidrag-output">Ctrl+Click to select multiple items...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Swap Plugin -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>Swap Plugin</h3>
          <p>Swap-based sorting instead of insertion-based with overlap detection</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
              <div>
                <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Insert Mode (Default)</h4>
                <ul class="sortable-list" id="insert-list">
                  <li class="sortable-item" data-id="insert-1">
                    <div class="item-content">
                      <div class="item-icon" style="background: #3b82f6;">A</div>
                      <div class="item-text">First Item</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="insert-2">
                    <div class="item-content">
                      <div class="item-icon" style="background: #10b981;">B</div>
                      <div class="item-text">Second Item</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="insert-3">
                    <div class="item-content">
                      <div class="item-icon" style="background: #f59e0b;">C</div>
                      <div class="item-text">Third Item</div>
                    </div>
                  </li>
                </ul>
              </div>
              <div>
                <h4 style="margin-bottom: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">Swap Mode (Plugin)</h4>
                <ul class="sortable-list" id="swap-list">
                  <li class="sortable-item" data-id="swap-1">
                    <div class="item-content">
                      <div class="item-icon" style="background: #8b5cf6;">X</div>
                      <div class="item-text">Alpha</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="swap-2">
                    <div class="item-content">
                      <div class="item-icon" style="background: #ef4444;">Y</div>
                      <div class="item-text">Beta</div>
                    </div>
                  </li>
                  <li class="sortable-item" data-id="swap-3">
                    <div class="item-content">
                      <div class="item-icon" style="background: #06b6d4;">Z</div>
                      <div class="item-text">Gamma</div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="swap-config">{
  "swapThreshold": 0.5,
  "swapClass": "sortable-swap-highlight",
  "animation": 200,
  "animationDuration": 150
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="swap-output">Compare insert vs swap behavior...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- AutoScroll Plugin -->
      <div class="demo-card">
        <div class="demo-header">
          <h3>AutoScroll Plugin</h3>
          <p>Automatic scrolling when dragging near container edges</p>
        </div>
        <div class="demo-content">
          <div class="demo-visual">
            <div style="height: 200px; overflow-y: auto; border: 2px dashed var(--border); border-radius: var(--radius); background: var(--bg-secondary);">
              <ul class="sortable-list" id="autoscroll-list" style="height: 400px; border: none; background: transparent;">
                <li class="sortable-item" data-id="scroll-1">
                  <div class="item-content">
                    <div class="item-icon" style="background: #3b82f6;">1</div>
                    <div class="item-text">Scroll Item 1</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-2">
                  <div class="item-content">
                    <div class="item-icon" style="background: #10b981;">2</div>
                    <div class="item-text">Scroll Item 2</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-3">
                  <div class="item-content">
                    <div class="item-icon" style="background: #f59e0b;">3</div>
                    <div class="item-text">Scroll Item 3</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-4">
                  <div class="item-content">
                    <div class="item-icon" style="background: #ef4444;">4</div>
                    <div class="item-text">Scroll Item 4</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-5">
                  <div class="item-content">
                    <div class="item-icon" style="background: #8b5cf6;">5</div>
                    <div class="item-text">Scroll Item 5</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-6">
                  <div class="item-content">
                    <div class="item-icon" style="background: #06b6d4;">6</div>
                    <div class="item-text">Scroll Item 6</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-7">
                  <div class="item-content">
                    <div class="item-icon" style="background: #84cc16;">7</div>
                    <div class="item-text">Scroll Item 7</div>
                  </div>
                </li>
                <li class="sortable-item" data-id="scroll-8">
                  <div class="item-content">
                    <div class="item-icon" style="background: #f97316;">8</div>
                    <div class="item-text">Scroll Item 8</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Configuration (Editable)</div>
              <div class="code-content">
                <textarea class="code-textarea" id="autoscroll-config">{
  "speed": 10,
  "sensitivity": 50,
  "scrollX": true,
  "scrollY": true,
  "maxSpeed": 30,
  "animation": 150
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="autoscroll-output">Drag near edges to trigger scroll...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Nested Horizontal/Vertical Dragging -->
      <div class="demo-card" style="grid-column: 1 / -1;">
        <div class="demo-header">
          <h3>Nested Horizontal/Vertical Dragging</h3>
          <p>Vertical containers with horizontal inner items - drag containers by handles or move items between containers</p>
        </div>
        <div class="demo-content" style="grid-template-columns: 2fr 1fr;">
          <div class="demo-visual">
            <div id="nested-vertical-list">
              <div class="nested-container" data-id="container-1">
                <div class="nested-header">
                  <div class="nested-handle">⋮⋮</div>
                  <div class="nested-title">Dashboard Widgets</div>
                  <div class="nested-count">5 items</div>
                </div>
                <div class="horizontal-items" data-container="1">
                  <div class="horizontal-item color-1" data-id="w1-1">📊</div>
                  <div class="horizontal-item color-2" data-id="w1-2">📈</div>
                  <div class="horizontal-item color-3" data-id="w1-3">🎯</div>
                  <div class="horizontal-item color-4" data-id="w1-4">⚡</div>
                  <div class="horizontal-item color-5" data-id="w1-5">🔥</div>
                </div>
              </div>

              <div class="nested-container" data-id="container-2">
                <div class="nested-header">
                  <div class="nested-handle">⋮⋮</div>
                  <div class="nested-title">User Interface</div>
                  <div class="nested-count">5 items</div>
                </div>
                <div class="horizontal-items" data-container="2">
                  <div class="horizontal-item color-6" data-id="w2-1">🎨</div>
                  <div class="horizontal-item color-7" data-id="w2-2">🖼️</div>
                  <div class="horizontal-item color-8" data-id="w2-3">🎭</div>
                  <div class="horizontal-item color-1" data-id="w2-4">✨</div>
                  <div class="horizontal-item color-2" data-id="w2-5">🌟</div>
                </div>
              </div>

              <div class="nested-container" data-id="container-3">
                <div class="nested-header">
                  <div class="nested-handle">⋮⋮</div>
                  <div class="nested-title">Data Processing</div>
                  <div class="nested-count">5 items</div>
                </div>
                <div class="horizontal-items" data-container="3">
                  <div class="horizontal-item color-3" data-id="w3-1">⚙️</div>
                  <div class="horizontal-item color-4" data-id="w3-2">🔧</div>
                  <div class="horizontal-item color-5" data-id="w3-3">🛠️</div>
                  <div class="horizontal-item color-6" data-id="w3-4">🔩</div>
                  <div class="horizontal-item color-7" data-id="w3-5">⚡</div>
                </div>
              </div>

              <div class="nested-container" data-id="container-4">
                <div class="nested-header">
                  <div class="nested-handle">⋮⋮</div>
                  <div class="nested-title">Empty Section</div>
                  <div class="nested-count">0 items</div>
                </div>
                <div class="horizontal-items" data-container="4">
                </div>
              </div>
            </div>
          </div>
          <div class="demo-code">
            <div class="code-editor">
              <div class="code-header">Container Configuration</div>
              <div class="code-content">
                <textarea class="code-textarea" id="nested-config">{
  "handle": ".nested-handle",
  "animation": 150,
  "ghostClass": "sortable-ghost",
  "chosenClass": "sortable-chosen",
  "direction": "vertical"
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Item Configuration</div>
              <div class="code-content">
                <textarea class="code-textarea" id="nested-item-config">{
  "group": "nested-items",
  "animation": 200,
  "direction": "horizontal",
  "ghostClass": "sortable-ghost",
  "emptyInsertThreshold": 50
}</textarea>
              </div>
            </div>
            <div class="code-editor">
              <div class="code-header">Event Output</div>
              <div class="code-content">
                <div class="code-output" id="nested-output">Drag containers by handles or move items between containers...</div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Status Bar -->
  <div class="status-bar">
    <div class="status-item">
      <div class="status-indicator"></div>
      <span>Resortable v2.0.0 Loaded</span>
    </div>
    <div class="status-item">
      <span>TypeScript Support: Active</span>
    </div>
    <div class="status-item">
      <span>Plugins: AutoScroll, MultiDrag, Swap</span>
    </div>
  </div>

  <!-- Load Resortable -->
  <script type="module">
    import { Sortable, PluginSystem } from '/src/index.ts';
    import { registerAllPlugins } from '/src/plugins/index.ts';

    // Register all plugins
    registerAllPlugins();

    // Expose to global window for debugging
    window.Sortable = Sortable;
    window.PluginSystem = PluginSystem;

    // Global flag for tests
    window.resortableLoaded = false;

    // Store all sortable instances
    const sortables = new Map();

    // Utility function to safely parse JSON
    function parseConfig(configText) {
      try {
        return JSON.parse(configText);
      } catch (e) {
        console.warn('Invalid JSON config:', e.message);
        return {};
      }
    }

    // Utility function to format event output
    function formatEventOutput(eventName, event) {
      const output = {
        event: eventName,
        timestamp: new Date().toLocaleTimeString(),
        item: event.item?.dataset?.id || 'unknown',
        from: event.from?.id || 'unknown',
        to: event.to?.id || 'unknown',
        oldIndex: event.oldIndex,
        newIndex: event.newIndex
      };

      if (event.pullMode) {
        output.pullMode = event.pullMode;
      }

      if (event.items && event.items.length > 1) {
        output.items = event.items.map(item => item.dataset.id);
      }

      return JSON.stringify(output, null, 2);
    }

    // Create sortable with configuration
    function createSortable(elementId, configTextarea, outputElement, extraOptions = {}) {
      const element = document.getElementById(elementId);
      const config = parseConfig(configTextarea.value);
      const options = { ...config, ...extraOptions };

      // Add event handlers
      const eventHandlers = {
        onStart: (e) => outputElement.textContent = formatEventOutput('start', e),
        onEnd: (e) => outputElement.textContent = formatEventOutput('end', e),
        onAdd: (e) => outputElement.textContent = formatEventOutput('add', e),
        onUpdate: (e) => outputElement.textContent = formatEventOutput('update', e),
        onRemove: (e) => outputElement.textContent = formatEventOutput('remove', e),
        onSort: (e) => outputElement.textContent = formatEventOutput('sort', e),
        onSelect: (e) => outputElement.textContent = formatEventOutput('select', e),
        onChoose: (e) => outputElement.textContent = formatEventOutput('choose', e),
        onUnchoose: (e) => outputElement.textContent = formatEventOutput('unchoose', e),
        onChange: (e) => outputElement.textContent = formatEventOutput('change', e),
        onClone: (e) => outputElement.textContent = formatEventOutput('clone', e),
        onFilter: (e) => outputElement.textContent = `Filter triggered: ${e.target.tagName}`,
      };

      // Destroy existing instance
      if (sortables.has(elementId)) {
        sortables.get(elementId).destroy();
      }

      // Create new instance
      const sortable = new Sortable(element, { ...options, ...eventHandlers });
      sortables.set(elementId, sortable);

      return sortable;
    }

    // Setup configuration editors
    function setupConfigEditor(configId, elementId, outputId, extraOptions = {}) {
      const configTextarea = document.getElementById(configId);
      const outputElement = document.getElementById(outputId);

      // Initial setup
      createSortable(elementId, configTextarea, outputElement, extraOptions);

      // Update on config change
      configTextarea.addEventListener('input', () => {
        createSortable(elementId, configTextarea, outputElement, extraOptions);
      });
    }

    // Enhanced sortable creator with plugin support
    function createSortableWithPlugin(elementId, configTextarea, outputElement, extraOptions = {}) {
      const element = document.getElementById(elementId);
      const config = parseConfig(configTextarea.value);
      const options = { ...config, ...extraOptions };

      // Extract plugin installation flag
      const pluginName = extraOptions._pluginInstall;
      delete options._pluginInstall;

      // Add event handlers
      const eventHandlers = {
        onStart: (e) => outputElement.textContent = formatEventOutput('start', e),
        onEnd: (e) => outputElement.textContent = formatEventOutput('end', e),
        onAdd: (e) => outputElement.textContent = formatEventOutput('add', e),
        onUpdate: (e) => outputElement.textContent = formatEventOutput('update', e),
        onRemove: (e) => outputElement.textContent = formatEventOutput('remove', e),
        onSort: (e) => outputElement.textContent = formatEventOutput('sort', e),
        onSelect: (e) => outputElement.textContent = formatEventOutput('select', e),
        onChoose: (e) => outputElement.textContent = formatEventOutput('choose', e),
        onUnchoose: (e) => outputElement.textContent = formatEventOutput('unchoose', e),
        onChange: (e) => outputElement.textContent = formatEventOutput('change', e),
        onClone: (e) => outputElement.textContent = formatEventOutput('clone', e),
        onFilter: (e) => outputElement.textContent = `Filter triggered: ${e.target.tagName}`,
      };

      // Destroy existing instance
      if (sortables.has(elementId)) {
        sortables.get(elementId).destroy();
      }

      // Create new instance
      const sortable = new Sortable(element, { ...options, ...eventHandlers });

      // Install plugin if specified
      if (pluginName) {
        try {
          PluginSystem.install(sortable, pluginName);
        } catch (e) {
          console.warn(`${pluginName} plugin not available:`, e.message);
        }
      }

      sortables.set(elementId, sortable);
      return sortable;
    }

    // Initialize all demos
    function initializeDemos() {
      // Basic sorting
      setupConfigEditor('basic-config', 'basic-list', 'basic-output');

      // Multi-selection with accessibility
      setupConfigEditor('multi-config', 'multi-list', 'multi-output');

      // Handle and filter
      setupConfigEditor('handle-config', 'handle-list', 'handle-output');

      // Shared groups - setup both lists with same group
      const groupConfig = document.getElementById('group-config');
      const groupOutput = document.getElementById('group-output');

      function setupGroupSortables() {
        const config = parseConfig(groupConfig.value);

        ['group-todo', 'group-done'].forEach(id => {
          if (sortables.has(id)) {
            sortables.get(id).destroy();
          }

          const element = document.getElementById(id);
          const sortable = new Sortable(element, {
            ...config,
            onStart: (e) => groupOutput.textContent = formatEventOutput('start', e),
            onEnd: (e) => groupOutput.textContent = formatEventOutput('end', e),
            onAdd: (e) => groupOutput.textContent = formatEventOutput('add', e),
            onRemove: (e) => groupOutput.textContent = formatEventOutput('remove', e),
            onSort: (e) => groupOutput.textContent = formatEventOutput('sort', e),
          });

          sortables.set(id, sortable);
        });
      }

      setupGroupSortables();
      groupConfig.addEventListener('input', setupGroupSortables);

      // Clone mode - source with clone, target accepts
      const cloneConfig = document.getElementById('clone-config');
      const cloneOutput = document.getElementById('clone-output');

      function setupCloneSortables() {
        const sourceConfig = parseConfig(cloneConfig.value);
        const targetConfig = {
          group: {
            name: 'components',
            pull: false,
            put: ['components']
          },
          animation: sourceConfig.animation || 150
        };

        // Clone source
        if (sortables.has('clone-source')) {
          sortables.get('clone-source').destroy();
        }

        const sourceElement = document.getElementById('clone-source');
        const sourceSortable = new Sortable(sourceElement, {
          ...sourceConfig,
          onStart: (e) => cloneOutput.textContent = formatEventOutput('start', e),
          onEnd: (e) => cloneOutput.textContent = formatEventOutput('end', e),
          onClone: (e) => cloneOutput.textContent = formatEventOutput('clone', e),
        });
        sortables.set('clone-source', sourceSortable);

        // Clone target
        if (sortables.has('clone-target')) {
          sortables.get('clone-target').destroy();
        }

        const targetElement = document.getElementById('clone-target');
        const targetSortable = new Sortable(targetElement, {
          ...targetConfig,
          onAdd: (e) => cloneOutput.textContent = formatEventOutput('add', e),
          onSort: (e) => cloneOutput.textContent = formatEventOutput('sort', e),
        });
        sortables.set('clone-target', targetSortable);
      }

      setupCloneSortables();
      cloneConfig.addEventListener('input', setupCloneSortables);

      // Grid layout
      setupConfigEditor('grid-config', 'grid-layout', 'grid-output');

      // Delay and thresholds
      setupConfigEditor('delay-config', 'delay-list', 'delay-output');

      // MultiDrag Plugin
      function setupMultiDragEditor() {
        const configTextarea = document.getElementById('multidrag-config');
        const outputElement = document.getElementById('multidrag-output');

        // Initial setup
        createSortableWithPlugin('multidrag-list', configTextarea, outputElement, {
          _pluginInstall: 'MultiDrag'
        });

        // Update on config change
        configTextarea.addEventListener('input', () => {
          createSortableWithPlugin('multidrag-list', configTextarea, outputElement, {
            _pluginInstall: 'MultiDrag'
          });
        });
      }
      setupMultiDragEditor();

      // Swap Plugin Demo - Setup both lists
      const swapConfig = document.getElementById('swap-config');
      const swapOutput = document.getElementById('swap-output');

      function setupSwapSortables() {
        const config = parseConfig(swapConfig.value);

        // Insert mode (normal behavior)
        if (sortables.has('insert-list')) {
          sortables.get('insert-list').destroy();
        }

        const insertElement = document.getElementById('insert-list');
        const insertSortable = new Sortable(insertElement, {
          animation: 150,
          ghostClass: 'sortable-ghost',
          onStart: (e) => swapOutput.textContent = formatEventOutput('insert-start', e),
          onEnd: (e) => swapOutput.textContent = formatEventOutput('insert-end', e),
          onSort: (e) => swapOutput.textContent = formatEventOutput('insert-sort', e),
        });
        sortables.set('insert-list', insertSortable);

        // Swap mode (with plugin)
        if (sortables.has('swap-list')) {
          sortables.get('swap-list').destroy();
        }

        const swapElement = document.getElementById('swap-list');
        const swapSortable = new Sortable(swapElement, {
          ...config,
          onStart: (e) => swapOutput.textContent = formatEventOutput('swap-start', e),
          onEnd: (e) => swapOutput.textContent = formatEventOutput('swap-end', e),
          onSort: (e) => swapOutput.textContent = formatEventOutput('swap-sort', e),
        });

        // Install Swap plugin
        try {
          PluginSystem.install(swapSortable, 'Swap');
        } catch (e) {
          console.warn('Swap plugin not available:', e.message);
        }

        sortables.set('swap-list', swapSortable);
      }

      setupSwapSortables();
      swapConfig.addEventListener('input', setupSwapSortables);

      // AutoScroll Plugin
      function setupAutoScrollEditor() {
        const configTextarea = document.getElementById('autoscroll-config');
        const outputElement = document.getElementById('autoscroll-output');

        // Initial setup
        createSortableWithPlugin('autoscroll-list', configTextarea, outputElement, {
          _pluginInstall: 'AutoScroll'
        });

        // Update on config change
        configTextarea.addEventListener('input', () => {
          createSortableWithPlugin('autoscroll-list', configTextarea, outputElement, {
            _pluginInstall: 'AutoScroll'
          });
        });
      }
      setupAutoScrollEditor();

      // Nested Horizontal/Vertical Dragging
      function setupNestedDragging() {
        const containerConfig = document.getElementById('nested-config');
        const itemConfig = document.getElementById('nested-item-config');
        const outputElement = document.getElementById('nested-output');

        function updateItemCount(container) {
          const countElement = container.querySelector('.nested-count');
          const itemsContainer = container.querySelector('.horizontal-items');
          const itemCount = itemsContainer.children.length;
          countElement.textContent = `${itemCount} items`;
        }

        function createNestedSortables() {
          const containerConfigData = parseConfig(containerConfig.value);
          const itemConfigData = parseConfig(itemConfig.value);

          // Destroy existing sortables
          ['nested-vertical-list', 'nested-items-1', 'nested-items-2', 'nested-items-3', 'nested-items-4'].forEach(id => {
            if (sortables.has(id)) {
              sortables.get(id).destroy();
            }
          });

          // Setup vertical container sortable
          const verticalList = document.getElementById('nested-vertical-list');
          const verticalSortable = new Sortable(verticalList, {
            ...containerConfigData,
            draggable: '.nested-container',
            onStart: (e) => {
              outputElement.textContent = formatEventOutput('container-start', e);
            },
            onEnd: (e) => {
              outputElement.textContent = formatEventOutput('container-end', e);
            },
            onSort: (e) => {
              outputElement.textContent = formatEventOutput('container-sort', e);
            },
          });
          sortables.set('nested-vertical-list', verticalSortable);

          // Setup horizontal item sortables for each container
          const horizontalContainers = document.querySelectorAll('.horizontal-items');
          horizontalContainers.forEach((container, index) => {
            const containerId = `nested-items-${index + 1}`;

            const horizontalSortable = new Sortable(container, {
              ...itemConfigData,
              draggable: '.horizontal-item',
              onStart: (e) => {
                outputElement.textContent = formatEventOutput('item-start', {
                  ...e,
                  containerName: container.parentElement?.querySelector('.nested-title')?.textContent || 'unknown'
                });
              },
              onEnd: (e) => {
                // Update item counts for both containers
                updateItemCount(e.from.closest('.nested-container'));
                if (e.to !== e.from) {
                  updateItemCount(e.to.closest('.nested-container'));
                }

                outputElement.textContent = formatEventOutput('item-end', {
                  ...e,
                  fromContainer: e.from.parentElement?.querySelector('.nested-title')?.textContent || 'unknown',
                  toContainer: e.to.parentElement?.querySelector('.nested-title')?.textContent || 'unknown'
                });
              },
              onAdd: (e) => {
                updateItemCount(e.to.closest('.nested-container'));
                outputElement.textContent = formatEventOutput('item-add', {
                  ...e,
                  toContainer: e.to.parentElement?.querySelector('.nested-title')?.textContent || 'unknown'
                });
              },
              onRemove: (e) => {
                updateItemCount(e.from.closest('.nested-container'));
                outputElement.textContent = formatEventOutput('item-remove', {
                  ...e,
                  fromContainer: e.from.parentElement?.querySelector('.nested-title')?.textContent || 'unknown'
                });
              },
              onSort: (e) => {
                updateItemCount(e.from.closest('.nested-container'));
                outputElement.textContent = formatEventOutput('item-sort', {
                  ...e,
                  containerName: e.from.parentElement?.querySelector('.nested-title')?.textContent || 'unknown'
                });
              },
            });

            sortables.set(containerId, horizontalSortable);
          });
        }

        // Enhanced format function for nested events
        function formatNestedEventOutput(eventName, event) {
          const output = {
            event: eventName,
            timestamp: new Date().toLocaleTimeString(),
            item: event.item?.dataset?.id || 'unknown',
          };

          if (event.containerName) {
            output.container = event.containerName;
          }

          if (event.fromContainer && event.toContainer) {
            output.from = event.fromContainer;
            output.to = event.toContainer;
          }

          if (event.oldIndex !== undefined && event.newIndex !== undefined) {
            output.oldIndex = event.oldIndex;
            output.newIndex = event.newIndex;
          }

          return JSON.stringify(output, null, 2);
        }

        // Override format function for nested events
        const originalFormatEventOutput = window.formatEventOutput;
        window.formatEventOutput = function(eventName, event) {
          if (eventName.startsWith('container-') || eventName.startsWith('item-')) {
            return formatNestedEventOutput(eventName, event);
          }
          return originalFormatEventOutput(eventName, event);
        };

        // Initial setup
        createNestedSortables();

        // Update on config changes
        containerConfig.addEventListener('input', createNestedSortables);
        itemConfig.addEventListener('input', createNestedSortables);
      }

      setupNestedDragging();
    }

    // Initialize when ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeDemos);
    } else {
      initializeDemos();
    }

    // Set global flag for tests
    window.resortableLoaded = true;
    window.sortables = sortables; // For debugging

    console.log('🎉 Resortable Feature Demo loaded successfully!');
  </script>
</body>
</html>